

# 单机秒杀系统-超卖问题解决

### 1. 开发环境

- GoLand
- Golang1.16.3
- Go Module
- Gin
- sqlx
- MySQL5.7
- Redis 5.0.3

### 2、解决方法

#### base

检测库存，得到库存count，判断count>0，扣库存。发现这种逻辑扣库存会有重复覆盖，而造成订单数超过库存数，超卖问题。

#### mutex互斥锁

使用互斥锁锁住数据库事务函数，超卖问题解决。

#### 数据库悲观锁

直接查找库存大于0的记录进行更新操作，从而对记录加排它锁，实现悲观锁，解决超卖问题。

#### 数据库乐观锁

库存表增加一个version字段，检查库存时，获取库存对应的版本信息，扣库存时通过版本信息过去记录，进行查询，对查询记录进行更新，解决超卖问题。

#### channel

使用sync.once开一个全局channel，并且开一个gorutine处理channel数据，每次请求都把参数写入channel中，gorutine处理线程每次从channel中读一个array并处理一个请求，解决超卖问题。





